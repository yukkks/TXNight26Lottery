<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hold to Lock</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    :root{
      --bg:#050505;
      --card:#0f0f0f;
      --text:#ffffff;
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.42);
      --bar:rgba(255,255,255,.9);
      --bar2:rgba(255,255,255,.18);
      --success:rgba(80, 255, 170, .95);
    }
    html, body { height: 100%; margin: 0; background: var(--bg); }
    body { min-height: 100vh; color: var(--text); }

    .box {
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 8px 30px rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.06);
    }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    .center { display:flex; flex-direction:column; align-items:center; gap:14px; padding: 26px 10px; }
    .logo{
      width: 220px;
      max-width: 80vw;
      height: auto;
      margin-bottom: 8px;
      display: block;
    }

    /* ===== Vertical Bar ===== */
    .barWrap{
      width: 240px; height: auto;
      position: relative;
      border-radius: 18px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap: 6px;
      padding: 12px 0;
      user-select:none; -webkit-user-select:none;
    }

    /* track */
    .barTrack{
      position:relative;
      width: 60px;
      height: 200px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
      filter: drop-shadow(0 0 18px rgba(255,255,255,.06));
      transition: filter .15s ease;
    }

    /* fill (bottom -> top) */
    .barFill{
      position:absolute;
      left:0; right:0; bottom:0;
      height: var(--h, 0%);
      background: linear-gradient(to top, var(--bar), var(--bar2));
      border-radius: 999px;
      transition: height 0.06s linear;
    }

    .copy{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap: 4px;
      margin-top: 26px;
      position:relative;
      z-index: 2;
      text-align: center;
    }
    .cta{
      font-weight: 900;
      letter-spacing: .6px;
      text-transform: uppercase;
      font-size: 1.15rem;
      opacity: .95;
    }
    .cta.locked{
      color: var(--success);
    }
    .hint{
      font-size: 12px;
      color: var(--muted2);
    }
    .hint.locked{
      font-size: 1.15rem;
      font-weight: 700;
    }
    .status{
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
      min-height: 20px;
      text-align:center;
    }

    /* Hold-down visual state */
    .pressed .barTrack{
      filter: drop-shadow(0 0 26px rgba(255,255,255,.14));
    }

    /* Success state */
    .success .barFill{
      background: linear-gradient(to top, rgba(80,255,170,.95), rgba(80,255,170,.22));
    }
    .sparkShower{
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      z-index: 20;
    }
    body.shower .sparkShower{
      opacity: 1;
    }
    .spark{
      position: absolute;
      width: 3px;
      height: 14px;
      background: rgba(80,255,170,.95);
      box-shadow: 0 0 12px rgba(80,255,170,.75);
      border-radius: 2px;
      animation: shower 900ms ease-out infinite;
    }
    .spark.s1{ left: 10%; top: -5%; animation-delay: 0ms; }
    .spark.s2{ left: 25%; top: -8%; animation-delay: 80ms; }
    .spark.s3{ left: 40%; top: -6%; animation-delay: 140ms; }
    .spark.s4{ left: 55%; top: -7%; animation-delay: 200ms; }
    .spark.s5{ left: 70%; top: -9%; animation-delay: 260ms; }
    .spark.s6{ left: 85%; top: -5%; animation-delay: 320ms; }
    .spark.s7{ left: 15%; top: -10%; animation-delay: 380ms; }
    .spark.s8{ left: 32%; top: -12%; animation-delay: 440ms; }
    .spark.s9{ left: 62%; top: -11%; animation-delay: 520ms; }
    .spark.s10{ left: 78%; top: -9%; animation-delay: 600ms; }

    @keyframes shower{
      0% { transform: translateY(-10vh) rotate(8deg); opacity: 0; }
      15% { opacity: 1; }
      100% { transform: translateY(110vh) rotate(18deg); opacity: 0; }
    }

    /* Button tweaks */
    #holdBtn{
      min-width: 140px;
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
      font-weight: 700;
      font-size: 1.1rem;
    }
    .buttons{
      margin-top: 4px;
      margin-bottom: 0;
    }

  </style>
</head>

<body>
  <section class="section">
    <div class="container" style="max-width: 620px;">
      <div class="box">
        <div class="center">
          <img class="logo" src="assets/tx-logo.png" alt="IQOS Together X">

          <div id="wrap" class="barWrap" aria-label="Hold to lock entry">
            <div id="track" class="barTrack">
              <div id="fill" class="barFill"></div>
            </div>


            <div class="copy">
              <div id="cta" class="cta">Hold to lock entry</div>
              <div id="sub" class="hint"></div>
            </div>
          </div>

          <div id="status" class="status"></div>

          <div class="buttons">
            <button id="holdBtn" class="button is-primary">Tap</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="sparkShower" aria-hidden="true">
    <span class="spark s1"></span>
    <span class="spark s2"></span>
    <span class="spark s3"></span>
    <span class="spark s4"></span>
    <span class="spark s5"></span>
    <span class="spark s6"></span>
    <span class="spark s7"></span>
    <span class="spark s8"></span>
    <span class="spark s9"></span>
    <span class="spark s10"></span>
  </div>

<script>
  // ===== SETTINGS =====
  const HOLD_MS = 1800;
  const LOADING_MS = 0;

  // ===== ELEMENTS =====
  const wrap = document.getElementById("wrap");
  const fill = document.getElementById("fill");
  const status = document.getElementById("status");
  const cta = document.getElementById("cta");
  const sub = document.getElementById("sub");
  const holdBtn = document.getElementById("holdBtn");

  // ===== STATE =====
  let holding = false;
  let startAt = 0;
  let raf = null;
  let locked = false;
  let loading = false;

  function setFill(pct){
    const clamped = Math.max(0, Math.min(1, pct));
    fill.style.setProperty("--h", `${clamped * 100}%`);
  }
  function show(text){ status.textContent = text; }


  function resetAll(){
    holding = false;
    startAt = 0;
    locked = false;
    loading = false;
    document.body.classList.remove("shower");
    wrap.classList.remove("pressed","success");
    cta.textContent = "Hold to lock entry";
    cta.classList.remove("locked");
    sub.textContent = "";
    sub.classList.remove("locked");
    show("");
    setFill(0);
    holdBtn.disabled = false;
    holdBtn.textContent = "Tap";
    if (raf) cancelAnimationFrame(raf);
    raf = null;
  }

  async function onComplete(){
    loading = true;
    wrap.classList.remove("pressed");
    holdBtn.disabled = true;
    if (LOADING_MS > 0) await new Promise(r => setTimeout(r, LOADING_MS));

    loading = false;
    locked = true;
    wrap.classList.add("success");
    document.body.classList.add("shower");
    cta.textContent = "Entry locked";
    cta.classList.add("locked");
    sub.textContent = "Watch for the signal";
    sub.classList.add("locked");
    show("");
    setFill(1);

    if (navigator.vibrate) navigator.vibrate([40, 20, 40]);
  }

  function tick(){
    if (!holding) return;
    const elapsed = Date.now() - startAt;
    const pct = Math.min(1, elapsed / HOLD_MS);
    setFill(pct);

    if (elapsed >= HOLD_MS){
      holding = false;
      onComplete();
      return;
    }
    raf = requestAnimationFrame(tick);
  }

  function startHold(e){
    if (locked || loading) return;
    e.preventDefault();
    if (holding) return;

    holding = true;
    startAt = Date.now();
    wrap.classList.add("pressed");

    show("");
    cta.textContent = "Holdingâ€¦";
    cta.classList.remove("locked");
    sub.textContent = "";
    sub.classList.remove("locked");

    tick();
  }

  function cancelHold(e){
    if (!holding) return;
    e.preventDefault();

    holding = false;
    wrap.classList.remove("pressed");

    cta.textContent = "Hold to lock entry";
    cta.classList.remove("locked");
    sub.textContent = "";
    sub.classList.remove("locked");
    setFill(0);
    if (raf) cancelAnimationFrame(raf);
    raf = null;

    if (navigator.vibrate) navigator.vibrate(15);
  }

  // Hold on the button to fill
  holdBtn.addEventListener("pointerdown", startHold);
  holdBtn.addEventListener("pointerup", cancelHold);
  holdBtn.addEventListener("pointercancel", cancelHold);
  holdBtn.addEventListener("pointerleave", cancelHold);
  holdBtn.addEventListener("click", (e) => e.preventDefault());

  // Optional: double-tap anywhere to reset
  let lastTap = 0;
  window.addEventListener("touchend", () => {
    const now = Date.now();
    if (now - lastTap < 300) resetAll();
    lastTap = now;
  }, {passive:true});

  resetAll();
</script>
</body>
</html>
