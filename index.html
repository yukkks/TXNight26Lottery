<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hold to Lock</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    :root{
      --bg:#050505;
      --card:#0f0f0f;
      --text:#ffffff;
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.42);
      --ring:rgba(255,255,255,.9);
      --ring2:rgba(255,255,255,.25);
      --success:rgba(80, 255, 170, .95);
    }
    body { background: var(--bg); color: var(--text); }

    .box {
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 8px 30px rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.06);
    }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    /* Center UI */
    .center { display:flex; flex-direction:column; align-items:center; gap:14px; padding: 26px 10px; }

    /* Hold button + ring */
    .ringWrap{
      width: 240px; height: 240px;
      position: relative;
      border-radius: 999px;
      display:flex; align-items:center; justify-content:center;
      user-select:none; -webkit-user-select:none;
      touch-action:none; /* important on mobile */
    }

    /* We draw progress via conic-gradient */
    .ring{
      position:absolute; inset:0;
      border-radius:999px;
      background:
        conic-gradient(var(--ring) 0deg, var(--ring) var(--deg), var(--ring2) var(--deg), var(--ring2) 360deg);
      filter: drop-shadow(0 0 18px rgba(255,255,255,.08));
      transition: filter .15s ease;
    }

    .inner{
      width: 190px; height: 190px;
      border-radius: 999px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.08);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap: 8px;
      position:relative;
      z-index: 2;
      transition: transform .12s ease, box-shadow .2s ease, border-color .2s ease;
    }

    .cta{
      font-weight: 900;
      letter-spacing: .6px;
      text-transform: uppercase;
      font-size: 14px;
      opacity: .95;
    }

    .hint{
      font-size: 12px;
      color: var(--muted2);
    }

    .status{
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
      min-height: 20px;
      text-align:center;
    }

    /* Pressed state */
    .pressed .inner{
      transform: scale(0.98);
      box-shadow: 0 0 0 2px rgba(255,255,255,.06), 0 0 24px rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.18);
    }
    .pressed .ring{
      filter: drop-shadow(0 0 26px rgba(255,255,255,.16));
    }

    /* Success state */
    .success .ring{
      background: conic-gradient(var(--success) 0deg, var(--success) 360deg);
      filter: drop-shadow(0 0 26px rgba(80,255,170,.22));
    }
    .success .inner{
      border-color: rgba(80,255,170,.25);
      box-shadow: 0 0 0 2px rgba(80,255,170,.10), 0 0 24px rgba(80,255,170,.18);
    }

    /* Popup */
    #overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.62); z-index: 50; }
    #popup {
      display:none;
      position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:#fff; color:#111;
      padding: 26px;
      border-radius: 14px;
      width: min(520px, 92vw);
      z-index: 60;
      box-shadow: 0 10px 40px rgba(0,0,0,.45);
    }
  </style>
</head>

<body>
  <section class="section">
    <div class="container" style="max-width: 620px;">
      <div class="box">
        <div class="center">
          <div class="has-text-grey-light">Your ID</div>
          <div class="title is-3 mono" style="margin-bottom:0;">USER 0142</div>

          <div id="wrap" class="ringWrap" aria-label="Hold to lock entry">
            <div id="ring" class="ring"></div>
            <div class="inner">
              <div id="cta" class="cta">Hold to lock entry</div>
              <div id="sub" class="hint">Release cancels</div>
            </div>
          </div>

          <div id="status" class="status"></div>

          <div class="buttons">
            <button id="autoBtn" class="button is-primary">Tap</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="overlay"></div>
  <div id="popup">
    <h2 class="title is-4">ENTRY LOCKED ✅</h2>
    <p style="margin-top:8px;">This is the “submitted” state (no backend).</p>
    <div style="margin-top:16px; text-align:right;">
      <button id="closePopup" class="button is-primary">OK</button>
    </div>
  </div>

<script>
  // ===== SETTINGS =====
  const HOLD_MS = 7000;   // change to 5000 if you want faster
  const LOADING_MS = 600; // simulated “submitting…” delay after hold completes

  // ===== ELEMENTS =====
  const wrap = document.getElementById("wrap");
  const ring = document.getElementById("ring");
  const status = document.getElementById("status");
  const cta = document.getElementById("cta");
  const sub = document.getElementById("sub");

  const overlay = document.getElementById("overlay");
  const popup = document.getElementById("popup");
  const closePopup = document.getElementById("closePopup");

  const autoBtn = document.getElementById("autoBtn");

  // ===== STATE =====
  let holding = false;
  let startAt = 0;
  let raf = null;
  let locked = false;
  let loading = false;

  function setDeg(deg){
    ring.style.setProperty("--deg", `${deg}deg`);
  }

  function show(text){ status.textContent = text; }

  function showPopup(){
    overlay.style.display = "block";
    popup.style.display = "block";
  }
  function hidePopup(){
    overlay.style.display = "none";
    popup.style.display = "none";
  }
  closePopup.addEventListener("click", hidePopup);
  overlay.addEventListener("click", hidePopup);

  function resetAll(){
    holding = false;
    startAt = 0;
    locked = false;
    loading = false;
    wrap.classList.remove("pressed","success");
    cta.textContent = "Hold to lock entry";
    sub.textContent = "Release cancels";
    show("");          // ✅ removed “Ready.”
    setDeg(0);
    if (raf) cancelAnimationFrame(raf);
    raf = null;
  }

  async function onComplete(){
    loading = true;
    show("Submitting…");
    cta.textContent = "Submitting…";
    sub.textContent = "Please wait";
    wrap.classList.remove("pressed");

    await new Promise(r => setTimeout(r, LOADING_MS));

    loading = false;
    locked = true;
    wrap.classList.add("success");
    cta.textContent = "Entry locked";
    sub.textContent = "Good luck";
    show("Submitted ✅");
    setDeg(360);

    if (navigator.vibrate) navigator.vibrate([40, 20, 40]);
    showPopup();
  }

  function tick(){
    if (!holding) return;
    const elapsed = Date.now() - startAt;
    const pct = Math.min(1, elapsed / HOLD_MS);
    setDeg(pct * 360);

    if (elapsed >= HOLD_MS){
      holding = false;
      onComplete();
      return;
    }
    raf = requestAnimationFrame(tick);
  }

  function startHold(e){
    if (locked || loading) return;
    e.preventDefault();
    if (holding) return;

    holding = true;
    startAt = Date.now();
    wrap.classList.add("pressed");

    show("Holding… don’t release.");
    cta.textContent = "Holding…";
    sub.textContent = `${Math.round(HOLD_MS/1000)}s to lock`;

    tick();
  }

  function endHold(e){
    if (!holding) return;
    e.preventDefault();

    holding = false;
    wrap.classList.remove("pressed");

    show("Released too early — try again.");
    cta.textContent = "Hold to lock entry";
    sub.textContent = "Release cancels";

    setDeg(0);
    if (raf) cancelAnimationFrame(raf);
    raf = null;

    if (navigator.vibrate) navigator.vibrate(20);
  }

  // Pointer events work on iOS/Android modern browsers
  wrap.addEventListener("pointerdown", startHold);
  window.addEventListener("pointerup", endHold);
  window.addEventListener("pointercancel", endHold);

  // Auto demo (for testing) — Tap simulates a full hold
  autoBtn.addEventListener("click", async () => {
    if (locked || loading) return;
    startHold(new Event("pointerdown"));
    await new Promise(r => setTimeout(r, HOLD_MS + 50));
  });

  resetAll();
</script>
</body>
</html>
